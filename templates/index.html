<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="UTF-8">
	<title>SafetyHealth.cloud: Moving fast for safety and and health</title>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script src="https://unpkg.com/vue@next"></script>
	<style>
	body {
		font-family: sans-serif;
		margin: 0;
	}
	
	#header,
	#main {
		padding: 10px;
	}
	
	#header {
		border-bottom: 1px solid red;
	}
	
	h1 {
		display: inline;
		font-size: 1.25em;
		color: red
	}
	
	h1 span {
		font-size: .75em;
		color: gray;
	}
table {
  border-collapse:collapse;
}
  th, td {border:1px solid #000; text-align:left; padding:5px; vertical-align: top;}
	</style>
	<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
	<script>
	$(function() {
    function updateUserInfo() {
    $.post('/user_info', function(data) {
								if(data.result == 200) {
									app.loggedIn = true;
									app.usersLoggedInEmail = data.data.email_address
                  app.first_name = data.data.first_name
                  app.middle_name = data.data.middle_name
                  app.last_name = data.data.last_name
                  app.date_of_birth = data.data.date_of_birth
                  app.age = data.data.age
                  app.persons_phone_numbers = data.data.persons_phone_numbers
                  app.contacts = data.data.contacts
                  app.current_physical_living_address_1 = data.data.current_physical_living_address_1
                  if (data.data.current_physical_living_address_2) {
                    app.current_physical_living_address_2 = data.data.current_physical_living_address_2
                  } else {
                    app.current_physical_living_address_2 = ''
                  
                  }
                  app.current_physical_living_address_city = data.data.current_physical_living_address_city
                  app.current_physical_living_address_state = data.data.current_physical_living_address_state
                  app.current_physical_living_address_zip_code = data.data.current_physical_living_address_zip_code
              
								} else {
									app.loggedIn = false;
								}
							})
    }
		const App = {
			data() {
					return {
						sentLoginEmail: false,
						email: '',
						loggedIn: false,
						usersLoggedInEmail: '',
            first_name: '',
            middle_name: '',
            last_name: '',
            date_of_birth: '',
            age: '',
            persons_phone_numbers: [],
            contacts: []
					}
				},
				created: function() {
					updateUserInfo()
				},
				methods: {
					sendLoginEmail: function(event) {
						this.email = $('#login_email').val();
						$.post("/send_login_email", {
							email: $('#login_email').val()
						}, function(data) {
							app.sentLoginEmail = true;
						});
					},
					login: function(event) {
						$.post("/login", {
							email_address: this.email,
							code: $('#login_code').val()
						}, function(data) {
							updateUserInfo()
						});
					}
				},
				delimiters: ['[[', ']]']
		}
		var app = Vue.createApp(App).mount('#app')
	});
	</script>
</head>

<body>
	<div id="app">
		<div id="header"> <span style="float:right">[[ usersLoggedInEmail ]]</span>
      <h1><img src="/static/911.png"> SafetyHealth<span>.cloud: Moving fast for safety and health</span></h1> </div>
      <div id="main">
		<div v-if="!loggedIn">
			<h3>Login</h3>
			<div v-if="sentLoginEmail"> <strong>Your login code:</strong>
				<input type="text" id="login_code" />
				<button @click="login">Login</button>
			</div>
			<div v-else> <strong>Your email (if you're a professional needing access for work then use your work email address):</strong>
				<input type="text" name="email" id="login_email" />
				<button @click="sendLoginEmail">Login</button>
			</div>
    </div>
    <div v-else>
      <strong>First name:</strong> [[ first_name ]]
      <strong>Middle name:</strong> [[ middle_name ]]
      <strong>Last name:</strong> [[ last_name ]]
      <strong>Date of birth:</strong> [[ date_of_birth ]]
      <strong>Age:</strong> [[ age ]]
      <br/>
<strong>Current physical living address:</strong> <a v-bind:href="'http://maps.google.com/maps?q='+current_physical_living_address_1+' '+current_physical_living_address_2+' '+current_physical_living_address_city+' '+current_physical_living_address_state+' '+current_physical_living_address_zip_code">
[[ current_physical_living_address_1 ]],
<span v-if="current_physical_living_address_2">[[ current_physical_living_address_2 ]], </span>[[ current_physical_living_address_city ]] 
 [[ current_physical_living_address_state ]],
 [[ current_physical_living_address_zip_code ]]</a>
 <br/>
 <strong>Phone number(s):</strong> <span v-for="phone_number in persons_phone_numbers">
        <a v-bind:href="'tel:+1'+phone_number.phone_number">[[ phone_number.phone_number ]]</a> ([[ phone_number.type ]])
      </span>
      <h3>Contacts</h3>
      <table>
        <tr><th>Name</th><th>Relationship</th><th>Phone number</th><th>Email</th></tr>
        <tr v-for="contact in contacts"><td>[[ contact.name ]]</td><td>[[ contact.relationship ]]</td>
        <td><a v-bind:href="'tel:+1'+contact.phone_number">[[ contact.phone_number ]]</a></td>
        <td><a v-bind:href="'mailto:'+contact.email">
          [[ contact.email ]]</a></td></tr>
        </table>
    </div>
  </div>
	</div>
</body>

</html>