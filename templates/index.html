<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>SafetyHealth.cloud: Moving fast for safety and and health</title>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script src="https://unpkg.com/vue@next"></script>
	<style>
	body {
		font-family: sans-serif;
	}
	
	#header {
		border-bottom: 1px solid red;
		padding: 10px;
	}
	
	h1 {
		display: inline;
		font-size: 1.25em;
		color: red
	}
	
	h1 span {
		font-size: .75em;
		color: gray;
	}
	</style>
	<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
	<script>
	$(function() {
		const App = {
			data() {
					return {
						sentLoginEmail: false,
						email: '',
						loggedIn: false,
						usersLoggedInEmail: ''
					}
				},
				created: function() {
					$.post('/user_info', function(data) {
						if(data.result == 200) {
							app.loggedIn = true;
							app.usersLoggedInEmail = data.data.email_address
						} else {
							app.loggedIn = false;
						}
					})
				},
				methods: {
					sendLoginEmail: function(event) {
						this.email = $('#login_email').val();
						$.post("/send_login_email", {
							email: $('#login_email').val()
						}, function(data) {
							app.sentLoginEmail = true;
						});
					},
					login: function(event) {
						$.post("/login", {
							email_address: this.email,
							code: $('#login_code').val()
						}, function(data) {
						});
						$.post("/user_info", function(data) {
							app.loggedIn = true;
						})
					}
				},
				delimiters: ['[[', ']]']
		}
		var app = Vue.createApp(App).mount('#app')
	});
	</script>
</head>

<body>
	<div id="app">
		<div id="header"> <span style="float:right">[[ usersLoggedInEmail ]]</span>
			<h1><img src="/static/911.png"> SafetyHealth<span>.cloud: Moving fast for safety and health</span></h1> </div>
		<div v-if="!loggedIn">
			<h3>Login</h3>
			<div v-if="sentLoginEmail"> <strong>Your login code:</strong>
				<input type="text" id="login_code" />
				<button @click="login">Login</button>
			</div>
			<div v-else> <strong>Your email (if you're a professional needing access for work then use your work email address):</strong>
				<input type="text" name="email" id="login_email" />
				<button @click="sendLoginEmail">Login</button>
			</div>
		</div>
	</div>
</body>

</html>